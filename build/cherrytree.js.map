{"version":3,"file":"cherrytree.js","sources":["../lib/dash.js","../lib/invariant.js","../lib/dsl.js","../lib/path.js","../lib/events.js","../lib/locations/location-bar.js","../lib/locations/browser.js","../lib/locations/memory.js","../lib/constants.js","../lib/transition.js","../lib/links.js","../lib/logger.js","../lib/qs.js","../lib/router.js"],"sourcesContent":["let toString = Object.prototype.toString\r\nlet keys = Object.keys\r\nlet assoc = (obj, attr, val) => { obj[attr] = val; return obj }\r\nlet isArray = Array.isArray\r\n\r\nexport let clone = obj =>\r\n  obj\r\n    ? isArray(obj)\r\n      ? obj.slice(0)\r\n      : extend({}, obj)\r\n    : obj\r\n\r\nexport let pick = (obj, attrs) =>\r\n  attrs.reduce((acc, attr) =>\r\n    obj[attr] === undefined\r\n      ? acc\r\n      : assoc(acc, attr, obj[attr]), {})\r\n\r\nexport let isEqual = (obj1, obj2) => {\r\n  const keys1 = keys(obj1)\r\n  return keys1.length === keys(obj2).length &&\r\n    keys1.every(key => obj2[key] === obj1[key])\r\n}\r\n\r\nexport let extend = (obj, ...rest) => {\r\n  rest.forEach(source => {\r\n    if (source) {\r\n      for (let prop in source) {\r\n        obj[prop] = source[prop]\r\n      }\r\n    }\r\n  })\r\n  return obj\r\n}\r\n\r\nexport let isString = obj =>\r\n  toString.call(obj) === '[object String]'\r\n","export default function invariant (condition, format, a, b, c, d, e, f) {\r\n  if (!condition) {\r\n    let args = [a, b, c, d, e, f]\r\n    let argIndex = 0\r\n    let error = new Error(\r\n      'Invariant Violation: ' +\r\n      format.replace(/%s/g, () => args[argIndex++])\r\n    )\r\n    error.framesToPop = 1 // we don't care about invariant's own frame\r\n    throw error\r\n  }\r\n}\r\n","/* eslint-disable standard/no-callback-literal */\r\nimport { clone } from './dash'\r\nimport invariant from './invariant'\r\n\r\nexport default function dsl (callback) {\r\n  let ancestors = []\r\n  let matches = {}\r\n  let names = {}\r\n\r\n  callback(function route (name, options, childrenCallback) {\r\n    let routes\r\n\r\n    invariant(!names[name], 'Route names must be unique, but route \"%s\" is declared multiple times', name)\r\n\r\n    names[name] = true\r\n\r\n    if (arguments.length === 1) {\r\n      options = {}\r\n    }\r\n\r\n    if (arguments.length === 2 && typeof options === 'function') {\r\n      childrenCallback = options\r\n      options = {}\r\n    }\r\n\r\n    if (typeof options.path !== 'string') {\r\n      let parts = name.split('.')\r\n      options.path = parts[parts.length - 1]\r\n    }\r\n\r\n    // go to the next level\r\n    if (childrenCallback) {\r\n      ancestors = ancestors.concat(name)\r\n      childrenCallback()\r\n      routes = pop()\r\n      ancestors.splice(-1)\r\n    }\r\n\r\n    // add the node to the tree\r\n    push({\r\n      name: name,\r\n      path: options.path,\r\n      routes: routes || [],\r\n      options: options,\r\n      ancestors: clone(ancestors)\r\n    })\r\n  })\r\n\r\n  function pop () {\r\n    return matches[currentLevel()] || []\r\n  }\r\n\r\n  function push (route) {\r\n    let level = currentLevel()\r\n    matches[level] = matches[level] || []\r\n    matches[level].push(route)\r\n  }\r\n\r\n  function currentLevel () {\r\n    return ancestors.join('.')\r\n  }\r\n\r\n  return pop()\r\n}\r\n","import invariant from './invariant'\r\nimport pathToRegexp from 'path-to-regexp'\r\n\r\nlet paramInjectMatcher = /:([a-zA-Z_$][a-zA-Z0-9_$?]*[?+*]?)/g\r\nlet specialParamChars = /[+*?]$/g\r\nlet queryMatcher = /\\?(.+)/\r\n\r\nlet _compiledPatterns = {}\r\n\r\nfunction compilePattern (pattern) {\r\n  if (!(pattern in _compiledPatterns)) {\r\n    let paramNames = []\r\n    let re = pathToRegexp(pattern, paramNames)\r\n\r\n    _compiledPatterns[pattern] = {\r\n      matcher: re,\r\n      paramNames: paramNames.map(p => p.name)\r\n    }\r\n  }\r\n\r\n  return _compiledPatterns[pattern]\r\n}\r\n\r\n/**\r\n * Returns an array of the names of all parameters in the given pattern.\r\n */\r\nexport function extractParamNames (pattern) {\r\n  return compilePattern(pattern).paramNames\r\n}\r\n\r\n/**\r\n * Extracts the portions of the given URL path that match the given pattern\r\n * and returns an object of param name => value pairs. Returns null if the\r\n * pattern does not match the given path.\r\n */\r\nexport function extractParams (pattern, path) {\r\n  let cp = compilePattern(pattern)\r\n  let matcher = cp.matcher\r\n  let paramNames = cp.paramNames\r\n  let match = path.match(matcher)\r\n\r\n  if (!match) {\r\n    return null\r\n  }\r\n\r\n  let params = {}\r\n\r\n  paramNames.forEach(function (paramName, index) {\r\n    params[paramName] = match[index + 1] && decodeURIComponent(match[index + 1])\r\n  })\r\n\r\n  return params\r\n}\r\n\r\n/**\r\n * Returns a version of the given route path with params interpolated. Throws\r\n * if there is a dynamic segment of the route path for which there is no param.\r\n */\r\nexport function injectParams (pattern, params) {\r\n  params = params || {}\r\n\r\n  return pattern.replace(paramInjectMatcher, function (match, param) {\r\n    let paramName = param.replace(specialParamChars, '')\r\n    let lastChar = param.slice(-1)\r\n\r\n    // If param is optional don't check for existence\r\n    if (lastChar === '?' || lastChar === '*') {\r\n      if (params[paramName] == null) {\r\n        return ''\r\n      }\r\n    } else {\r\n      invariant(\r\n        params[paramName] != null,\r\n        \"Missing '%s' parameter for path '%s'\",\r\n        paramName, pattern\r\n      )\r\n    }\r\n\r\n    let paramValue = encodeURIComponent(params[paramName])\r\n    if (lastChar === '*' || lastChar === '+') {\r\n      // restore / for splats\r\n      paramValue = paramValue.replace('%2F', '/')\r\n    }\r\n    return paramValue\r\n  })\r\n}\r\n\r\n/**\r\n * Returns an object that is the result of parsing any query string contained\r\n * in the given path, null if the path contains no query string.\r\n */\r\nexport function extractQuery (qs, path) {\r\n  let match = path.match(queryMatcher)\r\n  return match && qs.parse(match[1])\r\n}\r\n\r\n/**\r\n * Returns a version of the given path with the parameters in the given\r\n * query merged into the query string.\r\n */\r\nexport function withQuery (qs, path, query) {\r\n  let queryString = qs.stringify(query, { indices: false })\r\n\r\n  if (queryString) {\r\n    return withoutQuery(path) + '?' + queryString\r\n  }\r\n\r\n  return path\r\n}\r\n\r\n/**\r\n * Returns a version of the given path without the query string.\r\n */\r\nexport function withoutQuery (path) {\r\n  return path.replace(queryMatcher, '')\r\n}\r\n","export default {\r\n\r\n  /**\r\n  * Bind `el` event `type` to `fn`.\r\n  *\r\n  * @param {Element} el\r\n  * @param {String} type\r\n  * @param {Function} fn\r\n  * @return {Function}\r\n  * @api public\r\n  */\r\n\r\n  bind: function (el, type, fn) {\r\n    el.addEventListener(type, fn)\r\n    return fn\r\n  },\r\n\r\n  /**\r\n  * Unbind `el` event `type`'s callback `fn`.\r\n  *\r\n  * @param {Element} el\r\n  * @param {String} type\r\n  * @param {Function} fn\r\n  * @return {Function}\r\n  * @api public\r\n  */\r\n\r\n  unbind: function (el, type, fn) {\r\n    el.removeEventListener(type, fn)\r\n    return fn\r\n  }\r\n}\r\n","/* eslint-disable */\n// LocationBar module extracted from Backbone.js 1.1.0\n//\n// the dependency on backbone, underscore and jquery have been removed to turn\n// this into a small standalone library for handling browser's history API\n// cross browser and with a fallback to hashchange events or polling.\n\nimport {extend} from '../dash.js'\nimport events from '../events.js'\n\n// this is mostly original code with minor modifications\n// to avoid dependency on 3rd party libraries\n//\n// Backbone.History\n// ----------------\n\n// Handles cross-browser history management, based on either\n// [pushState](http://diveintohtml5.info/history.html) and real URLs, or\n// [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)\n// and URL fragments.\nvar History = function() {\n  this.handlers = [];\n  this.checkUrl = this.checkUrl.bind(this);\n\n  // Ensure that `History` can be used outside of the browser.\n  if (typeof window !== 'undefined') {\n    this.location = window.location;\n    this.history = window.history;\n  }\n};\n\n// Cached regex for stripping a leading hash/slash and trailing space.\nvar routeStripper = /^[#\\/]|\\s+$/g;\n\n// Cached regex for stripping leading and trailing slashes.\nvar rootStripper = /^\\/+|\\/+$/g;\n\n// Cached regex for removing a trailing slash.\nvar trailingSlash = /\\/$/;\n\n// Cached regex for stripping urls of hash.\nvar pathStripper = /#.*$/;\n\n// Set up all inheritable **Backbone.History** properties and methods.\nextend(History.prototype, {\n\n  // Are we at the app root?\n  atRoot: function() {\n    return this.location.pathname.replace(/[^\\/]$/, '$&/') === this.root;\n  },\n\n  // Gets the true hash value. Cannot use location.hash directly due to bug\n  // in Firefox where location.hash will always be decoded.\n  getHash: function() {\n    var match = this.location.href.match(/#(.*)$/);\n    return match ? match[1] : '';\n  },\n\n  // Get the cross-browser normalized URL fragment, either from the URL,\n  // the hash, or the override.\n  getFragment: function(fragment, forcePushState) {\n    if (fragment == null) {\n      if (this._hasPushState || !this._wantsHashChange || forcePushState) {\n        fragment = decodeURI(this.location.pathname + this.location.search);\n        var root = this.root.replace(trailingSlash, '');\n        if (!fragment.indexOf(root)) fragment = fragment.slice(root.length);\n      } else {\n        fragment = this.getHash();\n      }\n    }\n    return fragment.replace(routeStripper, '');\n  },\n\n  // Start the hash change handling, returning `true` if the current URL matches\n  // an existing route, and `false` otherwise.\n  start: function(options) {\n    // MODIFICATION OF ORIGINAL BACKBONE.HISTORY\n    // if (History.started) throw new Error(\"LocationBar has already been started\");\n    // History.started = true;\n    this.started = true;\n\n    // Figure out the initial configuration.\n    // Is pushState desired ... is it available?\n    this.options          = extend({root: '/'}, options);\n    this.location         = this.options.location || this.location;\n    this.history          = this.options.history || this.history;\n    this.root             = this.options.root;\n    this._wantsHashChange = this.options.hashChange !== false;\n    this._wantsPushState  = !!this.options.pushState;\n    this._hasPushState    = !!(this.options.pushState && this.history && this.history.pushState);\n    var fragment          = this.getFragment();\n\n    // Normalize root to always include a leading and trailing slash.\n    this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n\n    // Depending on whether we're using pushState or hashes, and whether\n    // 'onhashchange' is supported, determine how we check the URL state.\n    events.bind(window, this._hasPushState ? 'popstate' : 'hashchange', this.checkUrl);\n\n    // Determine if we need to change the base url, for a pushState link\n    // opened by a non-pushState browser.\n    this.fragment = fragment;\n    var loc = this.location;\n\n    // Transition from hashChange to pushState or vice versa if both are\n    // requested.\n    if (this._wantsHashChange && this._wantsPushState) {\n\n      // If we've started off with a route from a `pushState`-enabled\n      // browser, but we're currently in a browser that doesn't support it...\n      if (!this._hasPushState && !this.atRoot()) {\n        this.fragment = this.getFragment(null, true);\n        this.location.replace(this.root + '#' + this.fragment);\n        // Return immediately as browser will do redirect to new url\n        return true;\n\n      // Or if we've started out with a hash-based route, but we're currently\n      // in a browser where it could be `pushState`-based instead...\n      } else if (this._hasPushState && this.atRoot() && loc.hash) {\n        this.fragment = this.getHash().replace(routeStripper, '');\n        this.history.replaceState({}, document.title, this.root + this.fragment);\n      }\n\n    }\n\n    if (!this.options.silent) return this.loadUrl();\n  },\n\n  // Disable Backbone.history, perhaps temporarily. Not useful in a real app,\n  // but possibly useful for unit testing Routers.\n  stop: function() {\n    events.unbind(window, this._hasPushState ? 'popstate' : 'hashchange', this.checkUrl);\n    this.started = false;\n  },\n\n  // Add a route to be tested when the fragment changes. Routes added later\n  // may override previous routes.\n  route: function(route, callback) {\n    this.handlers.unshift({route: route, callback: callback});\n  },\n\n  // Checks the current URL to see if it has changed, and if it has,\n  // calls `loadUrl`.\n  checkUrl: function() {\n    var current = this.getFragment();\n    if (current === this.fragment) return false;\n    this.loadUrl();\n  },\n\n  // Attempt to load the current URL fragment. If a route succeeds with a\n  // match, returns `true`. If no defined routes matches the fragment,\n  // returns `false`.\n  loadUrl: function(fragment) {\n    fragment = this.fragment = this.getFragment(fragment);\n    return this.handlers.some(function(handler) {\n      if (handler.route.test(fragment)) {\n        handler.callback(fragment);\n        return true;\n      }\n    });\n  },\n\n  // Save a fragment into the hash history, or replace the URL state if the\n  // 'replace' option is passed. You are responsible for properly URL-encoding\n  // the fragment in advance.\n  //\n  // The options object can contain `trigger: true` if you wish to have the\n  // route callback be fired (not usually desirable), or `replace: true`, if\n  // you wish to modify the current URL without adding an entry to the history.\n  navigate: function(fragment, options) {\n    if (!this.started) return false;\n    if (!options || options === true) options = {trigger: !!options};\n\n    var url = this.root + (fragment = this.getFragment(fragment || ''));\n\n    // Strip the hash for matching.\n    fragment = fragment.replace(pathStripper, '');\n\n    if (this.fragment === fragment) return;\n    this.fragment = fragment;\n\n    // Don't include a trailing slash on the root.\n    if (fragment === '' && url !== '/') url = url.slice(0, -1);\n\n    // If pushState is available, we use it to set the fragment as a real URL.\n    if (this._hasPushState) {\n      this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n\n    // If hash changes haven't been explicitly disabled, update the hash\n    // fragment to store history.\n    } else if (this._wantsHashChange) {\n      this._updateHash(this.location, fragment, options.replace);\n    // If you've told us that you explicitly don't want fallback hashchange-\n    // based history, then `navigate` becomes a page refresh.\n    } else {\n      return this.location.assign(url);\n    }\n    if (options.trigger) return this.loadUrl(fragment);\n  },\n\n  // Update the hash location, either replacing the current entry, or adding\n  // a new one to the browser history.\n  _updateHash: function(location, fragment, replace) {\n    if (replace) {\n      var href = location.href.replace(/(javascript:|#).*$/, '');\n      location.replace(href + '#' + fragment);\n    } else {\n      // Some browsers require that `hash` contains a leading #.\n      location.hash = '#' + fragment;\n    }\n  }\n\n});\n\n// add some features to History\n\n// a more intuitive alias for navigate\nHistory.prototype.update = function () {\n  this.navigate.apply(this, arguments);\n};\n\n// a generic callback for any changes\nHistory.prototype.onChange = function (callback) {\n  this.route(/^(.*?)$/, callback);\n};\n\n// checks if the browser has pushstate support\nHistory.prototype.hasPushState = function () {\n  // MODIFICATION OF ORIGINAL BACKBONE.HISTORY\n  if (!this.started) {\n    throw new Error(\"only available after LocationBar.start()\");\n  }\n  return this._hasPushState;\n};\n\n\n// export\nexport default History;\n","import { extend } from '../dash'\r\nimport LocationBar from './location-bar'\r\n\r\nexport default BrowserLocation\r\n\r\nfunction BrowserLocation (options) {\r\n  this.path = options.path || ''\r\n\r\n  this.options = extend({\r\n    pushState: false,\r\n    root: '/'\r\n  }, options)\r\n\r\n  // we're using the location-bar module for actual\r\n  // URL management\r\n  let self = this\r\n  this.locationBar = new LocationBar()\r\n  this.locationBar.onChange(function (path) {\r\n    self.handleURL('/' + (path || ''))\r\n  })\r\n\r\n  this.locationBar.start(extend({}, options))\r\n}\r\n\r\n/**\r\n * Check if we're actually using pushState. For browsers\r\n * that don't support it this would return false since\r\n * it would fallback to using hashState / polling\r\n * @return {Bool}\r\n */\r\n\r\nBrowserLocation.prototype.usesPushState = function () {\r\n  return this.options.pushState && this.locationBar.hasPushState()\r\n}\r\n\r\n/**\r\n * Get the current URL\r\n */\r\n\r\nBrowserLocation.prototype.getURL = function () {\r\n  return this.path\r\n}\r\n\r\n/**\r\n * Set the current URL without triggering any events\r\n * back to the router. Add a new entry in browser's history.\r\n */\r\n\r\nBrowserLocation.prototype.setURL = function (path, options) {\r\n  if (this.path !== path) {\r\n    this.path = path\r\n    this.locationBar.update(path, extend({ trigger: true }, options))\r\n  }\r\n}\r\n\r\n/**\r\n * Set the current URL without triggering any events\r\n * back to the router. Replace the latest entry in broser's history.\r\n */\r\n\r\nBrowserLocation.prototype.replaceURL = function (path, options) {\r\n  if (this.path !== path) {\r\n    this.path = path\r\n    this.locationBar.update(path, extend({ trigger: true, replace: true }, options))\r\n  }\r\n}\r\n\r\n/**\r\n * Setup a URL change handler\r\n * @param  {Function} callback\r\n */\r\nBrowserLocation.prototype.onChange = function (callback) {\r\n  this.changeCallback = callback\r\n}\r\n\r\n/**\r\n * Given a path, generate a URL appending root\r\n * if pushState is used and # if hash state is used\r\n */\r\nBrowserLocation.prototype.formatURL = function (path) {\r\n  if (this.locationBar.hasPushState()) {\r\n    let rootURL = this.options.root\r\n    if (path !== '') {\r\n      rootURL = rootURL.replace(/\\/$/, '')\r\n    }\r\n    return rootURL + path\r\n  } else {\r\n    if (path[0] === '/') {\r\n      path = path.substr(1)\r\n    }\r\n    return '#' + path\r\n  }\r\n}\r\n\r\n/**\r\n * When we use pushState with a custom root option,\r\n * we need to take care of removingRoot at certain points.\r\n * Specifically\r\n * - browserLocation.update() can be called with the full URL by router\r\n * - LocationBar expects all .update() calls to be called without root\r\n * - this method is public so that we could dispatch URLs without root in router\r\n */\r\nBrowserLocation.prototype.removeRoot = function (url) {\r\n  if (this.options.pushState && this.options.root && this.options.root !== '/') {\r\n    return url.replace(this.options.root, '')\r\n  } else {\r\n    return url\r\n  }\r\n}\r\n\r\n/**\r\n * Stop listening to URL changes and link clicks\r\n */\r\nBrowserLocation.prototype.destroy = function () {\r\n  this.locationBar.stop()\r\n}\r\n\r\n/**\r\n  initially, the changeCallback won't be defined yet, but that's good\r\n  because we dont' want to kick off routing right away, the router\r\n  does that later by manually calling this handleURL method with the\r\n  url it reads of the location. But it's important this is called\r\n  first by Backbone, because we wanna set a correct this.path value\r\n\r\n  @private\r\n */\r\nBrowserLocation.prototype.handleURL = function (url) {\r\n  this.path = url\r\n  if (this.changeCallback) {\r\n    this.changeCallback(url)\r\n  }\r\n}\r\n","import { extend } from '../dash'\r\n\r\nexport default MemoryLocation\r\n\r\nfunction MemoryLocation (options) {\r\n  this.path = options.path || ''\r\n}\r\n\r\nMemoryLocation.prototype.getURL = function () {\r\n  return this.path\r\n}\r\n\r\nMemoryLocation.prototype.setURL = function (path, options) {\r\n  if (this.path !== path) {\r\n    this.path = path\r\n    this.handleURL(this.getURL(), options)\r\n  }\r\n}\r\n\r\nMemoryLocation.prototype.replaceURL = function (path, options) {\r\n  if (this.path !== path) {\r\n    this.setURL(path, options)\r\n  }\r\n}\r\n\r\nMemoryLocation.prototype.onChange = function (callback) {\r\n  this.changeCallback = callback\r\n}\r\n\r\nMemoryLocation.prototype.handleURL = function (url, options) {\r\n  this.path = url\r\n  options = extend({ trigger: true }, options)\r\n  if (this.changeCallback && options.trigger) {\r\n    this.changeCallback(url)\r\n  }\r\n}\r\n\r\nMemoryLocation.prototype.usesPushState = function () {\r\n  return false\r\n}\r\n\r\nMemoryLocation.prototype.removeRoot = function (url) {\r\n  return url\r\n}\r\n\r\nMemoryLocation.prototype.formatURL = function (url) {\r\n  return url\r\n}\r\n","export const TRANSITION_REDIRECTED = 'TransitionRedirected'\r\n\r\nexport const TRANSITION_CANCELLED = 'TransitionCancelled'\r\n","/* eslint-disable promise/param-names */\r\nimport { clone } from './dash'\r\nimport invariant from './invariant'\r\nimport { TRANSITION_CANCELLED, TRANSITION_REDIRECTED } from './constants'\r\n\r\nfunction runError (router, transition, err) {\r\n  router.middleware.forEach((m) => {\r\n    m.error && m.error(transition, err)\r\n  })\r\n}\r\n\r\nexport default function transition (options) {\r\n  options = options || {}\r\n\r\n  let router = options.router\r\n  let log = router.log\r\n  let logError = router.logError\r\n\r\n  let path = options.path\r\n  let match = options.match\r\n  let routes = match.routes\r\n  let params = match.params\r\n  let pathname = match.pathname\r\n  let query = match.query\r\n\r\n  let id = options.id\r\n  let startTime = Date.now()\r\n  log('---')\r\n  log('Transition #' + id, 'to', path)\r\n  log('Transition #' + id, 'routes:', routes.map(r => r.name))\r\n  log('Transition #' + id, 'params:', params)\r\n  log('Transition #' + id, 'query:', query)\r\n\r\n  // create the transition promise\r\n  let resolve, reject\r\n  let promise = new Promise(function (res, rej) {\r\n    resolve = res\r\n    reject = rej\r\n  })\r\n\r\n  // 1. make transition errors loud\r\n  // 2. by adding this handler we make sure\r\n  //    we don't trigger the default 'Potentially\r\n  //    unhandled rejection' for cancellations\r\n  promise.then(function () {\r\n    log('Transition #' + id, 'completed in', (Date.now() - startTime) + 'ms')\r\n  }).catch(function (err) {\r\n    if (err.type !== TRANSITION_REDIRECTED && err.type !== TRANSITION_CANCELLED) {\r\n      log('Transition #' + id, 'FAILED')\r\n      logError(err.message || err)\r\n    }\r\n  })\r\n\r\n  let cancelled = false\r\n\r\n  let transition = {\r\n    id: id,\r\n    prev: {\r\n      routes: clone(router.state.routes) || [],\r\n      path: router.state.path || '',\r\n      pathname: router.state.pathname || '',\r\n      params: clone(router.state.params) || {},\r\n      query: clone(router.state.query) || {}\r\n    },\r\n    routes: clone(routes),\r\n    path: path,\r\n    pathname: pathname,\r\n    params: clone(params),\r\n    query: clone(query),\r\n    redirectTo: function () {\r\n      return router.transitionTo.apply(router, arguments)\r\n    },\r\n    retry: function () {\r\n      return router.transitionTo(path)\r\n    },\r\n    cancel: function (err) {\r\n      if (router.state.activeTransition !== transition) {\r\n        return\r\n      }\r\n\r\n      if (transition.isCancelled) {\r\n        return\r\n      }\r\n\r\n      router.state.activeTransition = null\r\n      transition.isCancelled = true\r\n      cancelled = true\r\n\r\n      if (!err) {\r\n        err = new Error(TRANSITION_CANCELLED)\r\n        err.type = TRANSITION_CANCELLED\r\n      }\r\n      if (err.type === TRANSITION_CANCELLED) {\r\n        log('Transition #' + id, 'cancelled')\r\n      }\r\n      if (err.type === TRANSITION_REDIRECTED) {\r\n        log('Transition #' + id, 'redirected')\r\n      }\r\n\r\n      reject(err)\r\n    },\r\n    followRedirects: function () {\r\n      return promise['catch'](function (reason) {\r\n        if (router.state.activeTransition) {\r\n          return router.state.activeTransition.followRedirects()\r\n        }\r\n        return Promise.reject(reason)\r\n      })\r\n    },\r\n\r\n    then: promise.then.bind(promise),\r\n    catch: promise.catch.bind(promise)\r\n  }\r\n\r\n  // here we handle calls to all of the middlewares\r\n  function callNext (i, prevResult) {\r\n    let middleware\r\n    let middlewareName\r\n    // if transition has been cancelled - nothing left to do\r\n    if (cancelled) {\r\n      return\r\n    }\r\n    // done\r\n    if (i < router.middleware.length) {\r\n      middleware = router.middleware[i]\r\n      middlewareName = middleware.name || 'anonymous'\r\n      log('Transition #' + id, 'resolving middleware:', middlewareName)\r\n      let middlewarePromise\r\n      try {\r\n        middlewarePromise = middleware.next ? middleware.next(transition, prevResult) : prevResult\r\n        invariant(transition !== middlewarePromise, 'Middleware %s returned a transition which resulted in a deadlock', middlewareName)\r\n      } catch (err) {\r\n        router.state.activeTransition = null\r\n        runError(router, transition, err)\r\n        return reject(err)\r\n      }\r\n      Promise.resolve(middlewarePromise)\r\n        .then(function (result) {\r\n          callNext(i + 1, result)\r\n        })\r\n        .catch(function (err) {\r\n          log('Transition #' + id, 'resolving middleware:', middlewareName, 'FAILED')\r\n          router.state.activeTransition = null\r\n          runError(router, transition, err)\r\n          reject(err)\r\n        })\r\n    } else {\r\n      router.state = {\r\n        activeTransition: null,\r\n        routes: routes,\r\n        path: path,\r\n        pathname: pathname,\r\n        params: params,\r\n        query: query\r\n      }\r\n      router.middleware.forEach((m) => {\r\n        m.done && m.done(transition)\r\n      })\r\n      resolve()\r\n    }\r\n  }\r\n\r\n  if (!options.noop) {\r\n    Promise.resolve().then(() => callNext(0))\r\n  } else {\r\n    resolve()\r\n  }\r\n\r\n  if (options.noop) {\r\n    transition.noop = true\r\n  }\r\n\r\n  return transition\r\n}\r\n","import events from './events'\r\n\r\n/**\r\n * Handle link delegation on `el` or the document,\r\n * and invoke `fn(e)` when clickable.\r\n *\r\n * @param {Element|Function} el or fn\r\n * @param {Function} [fn]\r\n * @api public\r\n */\r\n\r\nexport function intercept (el, fn) {\r\n  // default to document\r\n  if (typeof el === 'function') {\r\n    fn = el\r\n    el = document\r\n  }\r\n\r\n  let cb = delegate(el, 'click', function (e, el) {\r\n    if (clickable(e, el)) fn(e, el)\r\n  })\r\n\r\n  return function dispose () {\r\n    undelegate(el, 'click', cb)\r\n  }\r\n}\r\n\r\nfunction link (element) {\r\n  element = { parentNode: element }\r\n\r\n  let root = document\r\n\r\n  // Make sure `element !== document` and `element != null`\r\n  // otherwise we get an illegal invocation\r\n  while ((element = element.parentNode) && element !== document) {\r\n    if (element.tagName.toLowerCase() === 'a') {\r\n      return element\r\n    }\r\n    // After `matches` on the edge case that\r\n    // the selector matches the root\r\n    // (when the root is not the document)\r\n    if (element === root) {\r\n      return\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Delegate event `type` to links\r\n * and invoke `fn(e)`. A callback function\r\n * is returned which may be passed to `.unbind()`.\r\n *\r\n * @param {Element} el\r\n * @param {String} selector\r\n * @param {String} type\r\n * @param {Function} fn\r\n * @param {Boolean} capture\r\n * @return {Function}\r\n * @api public\r\n */\r\n\r\nfunction delegate (el, type, fn) {\r\n  return events.bind(el, type, function (e) {\r\n    let target = e.target || e.srcElement\r\n    let el = link(target)\r\n    if (el) {\r\n      fn(e, el)\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * Unbind event `type`'s callback `fn`.\r\n *\r\n * @param {Element} el\r\n * @param {String} type\r\n * @param {Function} fn\r\n * @param {Boolean} capture\r\n * @api public\r\n */\r\n\r\nfunction undelegate (el, type, fn) {\r\n  events.unbind(el, type, fn)\r\n}\r\n\r\n/**\r\n * Check if `e` is clickable.\r\n */\r\n\r\nfunction clickable (e, el) {\r\n  if (which(e) !== 1) return\r\n  if (e.metaKey || e.ctrlKey || e.shiftKey) return\r\n  if (e.defaultPrevented) return\r\n\r\n  // check target\r\n  if (el.target) return\r\n\r\n  // check for data-bypass attribute\r\n  if (el.getAttribute('data-bypass') !== null) return\r\n\r\n  // inspect the href\r\n  let href = el.getAttribute('href')\r\n  if (!href || href.length === 0) return\r\n  // don't handle hash links\r\n  if (href[0] === '#') return\r\n  // external/absolute links\r\n  if (href.indexOf('http://') === 0 || href.indexOf('https://') === 0) return\r\n  // email links\r\n  if (href.indexOf('mailto:') === 0) return\r\n  // don't intercept javascript links\r\n  /* eslint-disable no-script-url */\r\n  if (href.indexOf('javascript:') === 0) return\r\n  /* eslint-enable no-script-url */\r\n\r\n  return true\r\n}\r\n\r\n/**\r\n * Event button.\r\n */\r\n\r\nfunction which (e) {\r\n  e = e || window.event\r\n  return e.which === null ? e.button : e.which\r\n}\r\n","export default function createLogger (log, options) {\r\n  options = options || {}\r\n  // falsy means no logging\r\n  if (!log) return () => {}\r\n  // custom logging function\r\n  if (log !== true) return log\r\n  // true means use the default logger - console\r\n  let fn = options.error ? console.error : console.info\r\n  return function () {\r\n    fn.apply(console, arguments)\r\n  }\r\n}\r\n","export default {\r\n  parse (querystring) {\r\n    return querystring.split('&').reduce((acc, pair) => {\r\n      let parts = pair.split('=')\r\n      acc[parts[0]] = decodeURIComponent(parts[1])\r\n      return acc\r\n    }, {})\r\n  },\r\n\r\n  stringify (params) {\r\n    return Object.keys(params).reduce((acc, key) => {\r\n      if (params[key] !== undefined) {\r\n        acc.push(key + '=' + encodeURIComponent(params[key]))\r\n      }\r\n      return acc\r\n    }, []).join('&')\r\n  }\r\n}\r\n","import { pick, clone, extend, isEqual, isString } from './dash'\r\nimport dsl from './dsl'\r\nimport { withQuery, withoutQuery, injectParams, extractParams, extractParamNames, extractQuery } from './path'\r\nimport invariant from './invariant'\r\nimport BrowserLocation from './locations/browser'\r\nimport MemoryLocation from './locations/memory'\r\nimport transition from './transition'\r\nimport { intercept } from './links'\r\nimport createLogger from './logger'\r\nimport qs from './qs'\r\nimport { TRANSITION_CANCELLED, TRANSITION_REDIRECTED } from './constants'\r\n\r\nfunction Cherrytree (options) {\r\n  this.nextId = 1\r\n  this.state = {}\r\n  this.middleware = []\r\n  this.options = extend({\r\n    location: 'browser',\r\n    interceptLinks: true,\r\n    logError: true,\r\n    qs: qs\r\n  }, options)\r\n  this.log = createLogger(this.options.log)\r\n  this.logError = createLogger(this.options.logError, { error: true })\r\n}\r\n\r\n/**\r\n * Add a middleware\r\n * @param  {Function} middleware\r\n * @return {Object}   router\r\n * @api public\r\n */\r\nCherrytree.prototype.use = function (middleware) {\r\n  const m = typeof middleware === 'function' ? { next: middleware } : middleware\r\n  this.middleware.push(m)\r\n  return this\r\n}\r\n\r\n/**\r\n * Add the route map\r\n * @param  {Function} routes\r\n * @return {Object}   router\r\n * @api public\r\n */\r\nCherrytree.prototype.map = function (routes) {\r\n  // create the route tree\r\n  this.routes = dsl(routes)\r\n\r\n  // create the matcher list, which is like a flattened\r\n  // list of routes = a list of all branches of the route tree\r\n  let matchers = this.matchers = []\r\n  // keep track of whether duplicate paths have been created,\r\n  // in which case we'll warn the dev\r\n  let dupes = {}\r\n  // keep track of abstract routes to build index route forwarding\r\n  let abstracts = {}\r\n\r\n  eachBranch({ routes: this.routes }, [], function (routes) {\r\n    // concatenate the paths of the list of routes\r\n    let path = routes.reduce(function (memo, r) {\r\n      // reset if there's a leading slash, otherwise concat\r\n      // and keep resetting the trailing slash\r\n      return (r.path[0] === '/' ? r.path : memo + '/' + r.path).replace(/\\/$/, '')\r\n    }, '')\r\n    // ensure we have a leading slash\r\n    if (path === '') {\r\n      path = '/'\r\n    }\r\n\r\n    let lastRoute = routes[routes.length - 1]\r\n\r\n    if (lastRoute.options.abstract) {\r\n      abstracts[path] = lastRoute.name\r\n      return\r\n    }\r\n\r\n    // register routes\r\n    matchers.push({\r\n      routes: routes,\r\n      name: lastRoute.name,\r\n      path: path\r\n    })\r\n\r\n    // dupe detection\r\n    if (dupes[path]) {\r\n      throw new Error('Routes ' + dupes[path] + ' and ' + lastRoute.name +\r\n      ' have the same url path \\'' + path + '\\'')\r\n    }\r\n    dupes[path] = lastRoute.name\r\n  })\r\n\r\n  // check if there is an index route for each abstract route\r\n  Object.keys(abstracts).forEach(function (path) {\r\n    let matcher\r\n    if (!dupes[path]) return\r\n\r\n    matchers.some(function (m) {\r\n      if (m.path === path) {\r\n        matcher = m\r\n        return true\r\n      }\r\n    })\r\n\r\n    matchers.push({\r\n      routes: matcher.routes,\r\n      name: abstracts[path],\r\n      path: path\r\n    })\r\n  })\r\n\r\n  function eachBranch (node, memo, fn) {\r\n    node.routes.forEach(function (route) {\r\n      fn(memo.concat(route))\r\n\r\n      if (route.routes.length) {\r\n        eachBranch(route, memo.concat(route), fn)\r\n      }\r\n    })\r\n  }\r\n\r\n  return this\r\n}\r\n\r\n/**\r\n * Starts listening to the location changes.\r\n * @param  {Object}  location (optional)\r\n * @return {Promise} initial transition\r\n *\r\n * @api public\r\n */\r\nCherrytree.prototype.listen = function (path) {\r\n  let location = this.location = this.createLocation(path || '')\r\n  // setup the location onChange handler\r\n  location.onChange((url) => this.dispatch(url))\r\n  // start intercepting links\r\n  if (this.options.interceptLinks && location.usesPushState()) {\r\n    this.interceptLinks()\r\n  }\r\n  // and also kick off the initial transition\r\n  return this.dispatch(location.getURL())\r\n}\r\n\r\n/**\r\n * Transition to a different route. Passe in url or a route name followed by params and query\r\n * @param  {String} url     url or route name\r\n * @param  {Object} params  Optional\r\n * @param  {Object} query   Optional\r\n * @return {Object}         transition\r\n *\r\n * @api public\r\n */\r\nCherrytree.prototype.transitionTo = function (...args) {\r\n  if (this.state.activeTransition) {\r\n    return this.replaceWith.apply(this, args)\r\n  }\r\n  return this.doTransition('setURL', args)\r\n}\r\n\r\n/**\r\n * Like transitionTo, but doesn't leave an entry in the browser's history,\r\n * so clicking back will skip this route\r\n * @param  {String} url     url or route name followed by params and query\r\n * @param  {Object} params  Optional\r\n * @param  {Object} query   Optional\r\n * @return {Object}         transition\r\n *\r\n * @api public\r\n */\r\nCherrytree.prototype.replaceWith = function (...args) {\r\n  return this.doTransition('replaceURL', args)\r\n}\r\n\r\n/**\r\n * Create an href\r\n * @param  {String} name   target route name\r\n * @param  {Object} params\r\n * @param  {Object} query\r\n * @return {String}        href\r\n *\r\n * @api public\r\n */\r\nCherrytree.prototype.generate = function (name, params, query) {\r\n  invariant(this.location, 'call .listen() before using .generate()')\r\n  let matcher\r\n\r\n  query = query || {}\r\n\r\n  this.matchers.forEach(function (m) {\r\n    if (m.name === name) {\r\n      matcher = m\r\n    }\r\n  })\r\n\r\n  if (!matcher) {\r\n    throw new Error('No route is named ' + name)\r\n  }\r\n\r\n  let url = withQuery(this.options.qs, injectParams(matcher.path, params), query)\r\n  return this.location.formatURL(url)\r\n}\r\n\r\n/**\r\n * Stop listening to URL changes\r\n * @api public\r\n */\r\nCherrytree.prototype.destroy = function () {\r\n  if (this.location && this.location.destroy) {\r\n    this.location.destroy()\r\n  }\r\n  if (this.disposeIntercept) {\r\n    this.disposeIntercept()\r\n  }\r\n  if (this.state.activeTransition) {\r\n    this.state.activeTransition.cancel()\r\n  }\r\n  this.state = {}\r\n}\r\n\r\n/**\r\n * Check if the given route/params/query combo is active\r\n * @param  {String} name   target route name\r\n * @param  {Object} params\r\n * @param  {Object} query\r\n * @return {Boolean}\r\n *\r\n * @api public\r\n */\r\nCherrytree.prototype.isActive = function (name, params, query) {\r\n  params = params || {}\r\n  query = query || {}\r\n\r\n  let activeRoutes = this.state.routes || []\r\n  let activeParams = this.state.params || {}\r\n  let activeQuery = this.state.query || {}\r\n\r\n  let isActive = activeRoutes.some(route => route.name === name)\r\n  isActive = isActive && Object.keys(params).every(key => activeParams[key] === params[key])\r\n  isActive = isActive && Object.keys(query).every(key => activeQuery[key] === query[key])\r\n\r\n  return isActive\r\n}\r\n\r\n/**\r\n * @api private\r\n */\r\nCherrytree.prototype.doTransition = function (method, params) {\r\n  let previousUrl = this.location.getURL()\r\n\r\n  let url = params[0]\r\n  if (url[0] !== '/') {\r\n    url = this.generate.apply(this, params)\r\n    url = url.replace(/^#/, '/')\r\n  }\r\n\r\n  if (this.options.pushState) {\r\n    url = this.location.removeRoot(url)\r\n  }\r\n\r\n  let transition = this.dispatch(url)\r\n\r\n  transition.catch((err) => {\r\n    if (err && err.type === TRANSITION_CANCELLED) {\r\n      // reset the URL in case the transition has been cancelled\r\n      this.location.replaceURL(previousUrl, { trigger: false })\r\n    }\r\n    return err\r\n  })\r\n\r\n  this.location[method](url, { trigger: false })\r\n\r\n  return transition\r\n}\r\n\r\n/**\r\n * Match the path against the routes\r\n * @param  {String} path\r\n * @return {Object} the list of matching routes and params\r\n *\r\n * @api private\r\n */\r\nCherrytree.prototype.match = function (path) {\r\n  path = (path || '').replace(/\\/$/, '') || '/'\r\n  let params\r\n  let routes = []\r\n  let pathWithoutQuery = withoutQuery(path)\r\n  let qs = this.options.qs\r\n  this.matchers.some(function (matcher) {\r\n    params = extractParams(matcher.path, pathWithoutQuery)\r\n    if (params) {\r\n      routes = matcher.routes\r\n      return true\r\n    }\r\n  })\r\n  return {\r\n    routes: routes.map(descriptor),\r\n    params: params || {},\r\n    pathname: pathWithoutQuery,\r\n    query: extractQuery(qs, path) || {}\r\n  }\r\n\r\n  // clone the data (only a shallow clone of options)\r\n  // to make sure the internal route store is not mutated\r\n  // by the middleware. The middleware can mutate data\r\n  // before it gets passed into the next middleware, but\r\n  // only within the same transition. New transitions\r\n  // will get to use pristine data.\r\n  function descriptor (route) {\r\n    return {\r\n      name: route.name,\r\n      path: route.path,\r\n      params: pick(params, extractParamNames(route.path)),\r\n      options: clone(route.options)\r\n    }\r\n  }\r\n}\r\n\r\nCherrytree.prototype.dispatch = function (path) {\r\n  let match = this.match(path)\r\n  let query = match.query\r\n  let pathname = match.pathname\r\n\r\n  let activeTransition = this.state.activeTransition\r\n\r\n  // if we already have an active transition with all the same\r\n  // params - return that and don't do anything else\r\n  if (activeTransition &&\r\n      activeTransition.pathname === pathname &&\r\n      isEqual(activeTransition.query, query)) {\r\n    return activeTransition\r\n  }\r\n\r\n  // otherwise, cancel the active transition since we're\r\n  // redirecting (or initiating a brand new transition)\r\n  if (activeTransition) {\r\n    let err = new Error(TRANSITION_REDIRECTED)\r\n    err.type = TRANSITION_REDIRECTED\r\n    err.nextPath = path\r\n    activeTransition.cancel(err)\r\n  }\r\n\r\n  // if there is no active transition, check if\r\n  // this is a noop transition, in which case, return\r\n  // a transition to respect the function signature,\r\n  // but don't actually run any of the middleware\r\n  if (!activeTransition) {\r\n    if (this.state.pathname === pathname &&\r\n        isEqual(this.state.query, query)) {\r\n      return transition({\r\n        id: this.nextId++,\r\n        path: path,\r\n        match: match,\r\n        noop: true,\r\n        router: this\r\n      })\r\n    }\r\n  }\r\n\r\n  let t = transition({\r\n    id: this.nextId++,\r\n    path: path,\r\n    match: match,\r\n    router: this\r\n  })\r\n\r\n  this.state.activeTransition = t\r\n\r\n  return t\r\n}\r\n\r\n/**\r\n * Create the default location.\r\n * This is used when no custom location is passed to\r\n * the listen call.\r\n * @return {Object} location\r\n *\r\n * @api private\r\n */\r\nCherrytree.prototype.createLocation = function (path) {\r\n  let location = this.options.location\r\n  if (!isString(location)) {\r\n    return location\r\n  }\r\n  if (location === 'browser') {\r\n    return new BrowserLocation(pick(this.options, ['pushState', 'root']))\r\n  } else if (location === 'memory') {\r\n    return new MemoryLocation({ path })\r\n  } else {\r\n    throw new Error('Location can be `browser`, `memory` or a custom implementation')\r\n  }\r\n}\r\n\r\n/**\r\n * When using pushState, it's important to setup link interception\r\n * because all link clicks should be handled via the router instead of\r\n * browser reloading the page\r\n */\r\nCherrytree.prototype.interceptLinks = function () {\r\n  let clickHandler = typeof this.options.interceptLinks === 'function'\r\n    ? this.options.interceptLinks\r\n    : defaultClickHandler\r\n  this.disposeIntercept = intercept((event, link) => clickHandler(event, link, this))\r\n\r\n  function defaultClickHandler (event, link, router) {\r\n    event.preventDefault()\r\n    router.transitionTo(router.location.removeRoot(link.getAttribute('href')))\r\n  }\r\n}\r\n\r\nexport default Cherrytree\r\n"],"names":["toString","Object","prototype","keys","assoc","obj","attr","val","isArray","Array","clone","slice","extend","pick","attrs","reduce","acc","undefined","isEqual","obj1","obj2","keys1","length","every","key","rest","forEach","source","prop","isString","call","invariant","condition","format","a","b","c","d","e","f","args","argIndex","error","Error","replace","framesToPop","dsl","callback","ancestors","matches","names","route","name","options","childrenCallback","routes","arguments","path","parts","split","concat","pop","splice","currentLevel","push","level","join","paramInjectMatcher","specialParamChars","queryMatcher","_compiledPatterns","compilePattern","pattern","paramNames","re","pathToRegexp","map","p","extractParamNames","extractParams","cp","matcher","match","params","paramName","index","decodeURIComponent","injectParams","param","lastChar","paramValue","encodeURIComponent","extractQuery","qs","parse","withQuery","query","queryString","stringify","indices","withoutQuery","el","type","fn","addEventListener","removeEventListener","History","handlers","checkUrl","bind","window","location","history","routeStripper","rootStripper","trailingSlash","pathStripper","pathname","root","href","fragment","forcePushState","_hasPushState","_wantsHashChange","decodeURI","search","indexOf","getHash","started","hashChange","_wantsPushState","pushState","getFragment","loc","atRoot","hash","replaceState","document","title","silent","loadUrl","unbind","unshift","current","some","handler","test","trigger","url","_updateHash","assign","update","navigate","apply","onChange","hasPushState","BrowserLocation","self","locationBar","LocationBar","handleURL","start","usesPushState","getURL","setURL","replaceURL","changeCallback","formatURL","rootURL","substr","removeRoot","destroy","stop","MemoryLocation","TRANSITION_REDIRECTED","TRANSITION_CANCELLED","runError","router","transition","err","middleware","m","log","logError","id","startTime","Date","now","r","resolve","reject","promise","Promise","res","rej","then","catch","message","cancelled","state","transitionTo","activeTransition","isCancelled","reason","followRedirects","callNext","i","prevResult","middlewareName","middlewarePromise","next","result","done","noop","intercept","cb","delegate","clickable","dispose","link","element","parentNode","tagName","toLowerCase","events","target","srcElement","undelegate","which","metaKey","ctrlKey","shiftKey","defaultPrevented","getAttribute","event","button","createLogger","console","info","querystring","pair","Cherrytree","nextId","use","matchers","dupes","abstracts","memo","lastRoute","abstract","eachBranch","node","listen","createLocation","dispatch","interceptLinks","replaceWith","doTransition","generate","disposeIntercept","cancel","isActive","activeRoutes","activeParams","activeQuery","method","previousUrl","pathWithoutQuery","descriptor","nextPath","t","clickHandler","defaultClickHandler","preventDefault"],"mappings":"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"}